# zig-gobject

Bindings for GObject-based libraries (such as GTK) generated using GObject
introspection data.

## Usage

To use the bindings, find the [latest release of this
project](https://github.com/ianprime0509/zig-gobject/releases) and add the
desired bindings artifact as a dependency in `build.zig.zon`. Then, the exposed
bindings can be used as modules. For example:

```zig
const gobject = b.dependency("gobject", .{});
exe.root_module.addImport("gtk", gobject.module("gtk-4.0"));
exe.root_module.addImport("adw", gobject.module("adw-1"));
```

## Examples

There are several examples in the `example` directory, which is itself a
runnable project (depending on the `bindings` directory as a dependency). After
generating the bindings, the examples can be run using `zig build run` in the
`example` directory.

## Development environment

The bindings generated by this project cover a wide variety of libraries, and it
can be annoying and inconvenient to install these libraries on a host system for
testing purposes. The best way to get a consistent environment for testing is to
use [Flatpak](https://flatpak.org/):

1. Install `flatpak`.
2. Install the base SDK dependencies:
   - `flatpak install org.freedesktop.Sdk//23.08`
   - `flatpak install org.gnome.Sdk//45`
3. Install the Zig master extension for the Freedesktop SDK. This is not (yet)
   available on Flathub, so it must be built and installed manually.
   1. Install `flatpak-builder`.
   2. Clone
      https://github.com/ianprime0509/org.freedesktop.Sdk.Extension.ziglang-master
      and use the branch corresponding to the Freedesktop SDK installed above.
   3. Inside the clone, run `flatpak-builder --user --install build-dir org.freedesktop.Sdk.Extension.ziglang-master.yml`.

The steps above only need to be done once per GNOME SDK version. To enter a
development environment:

1. Run `flatpak run --filesystem=home --share=network --share=ipc --socket=fallback-x11 --socket=wayland --device=dri --socket=session-bus org.gnome.Sdk//44`
   - `--filesystem=home` - makes the user's home directory available within the
     container
   - `--share=network` - allows network access (needed to fetch `build.zig.zon`
     dependencies)
   - `--share=ipc --socket=fallback-x11 --socket=wayland --device=dri` - allows
     graphical display through X11 or Wayland
  - `--socket=session-bus` - allows access to the session bus
2. Within the spawned shell, run `. /usr/lib/sdk/ziglang-master/enable.sh` to
   add Zig to your `PATH` (don't forget the `.` at the beginning of that
   command).

## Running the binding generator

The binding generator can be invoked using `zig build codegen`, which accepts
several useful options and is described further below, or by building the
`zig-gobject` binary using `zig build` and invoking it directly.

`zig build codegen` requires a set of modules to be used as input. The input
modules can be specified using `-Dmodules` to provide an explicit list of root
modules for codegen (the codegen process will also discover any necessary
dependencies): for example, `zig build codegen -Dmodules=Gtk-4.0` will generate
bindings for GTK 4 and anything else it depends on (Gio, GObject, GLib, and many
others).

Alternatively, if a Flatpak development environment is set up (see the section
above), a predefined GIR profile can be selected using `-Dgir-profile=gnome44`
or `-Dgir-profile=gnome45`, which includes all the modules available in the
respective GNOME SDK.

GIR files are assumed to be located in `/usr/share/gir-1.0` unless this is
overridden via `-Dgir-files-path`.

The bindings are generated to the `bindings` directory under the build prefix
(by default, `zig-out`).

## Running tests

`zig build test` will run the binding generator's tests. If bindings have been
generated, the `test` project directory contains a package depending on them
which runs tests on the generated bindings. The `zig build test` command in the
`test` project accepts the same `modules` and `gir-profile` options as the
codegen command to specify which modules to test (unlike codegen, the `modules`
option here specifies a complete list of modules to test: there is no discovery
and testing of dependency modules).

## Further reading

- [Binding strategy](./doc/binding-strategy.md)

## License

This project is released under the [Zero-Clause BSD
License](https://spdx.org/licenses/0BSD.html). The libraries exposed by the
generated bindings are subject to their own licenses.
